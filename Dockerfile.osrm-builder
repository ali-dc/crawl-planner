FROM ghcr.io/project-osrm/osrm-backend

RUN apk add --no-cache wget bash

COPY download_map.sh /usr/local/bin/download_map.sh
RUN chmod +x /usr/local/bin/download_map.sh

ENTRYPOINT ["/bin/bash", "-c"]
CMD ["cd /data && wget https://download.geofabrik.de/europe/united-kingdom/england/bristol-latest.osm.pbf && osrm-extract -p /opt/foot.lua /data/bristol-latest.osm.pbf && osrm-partition /data/bristol-latest.osrm && osrm-customize /data/bristol-latest.osrm && echo 'OSRM preprocessing complete!'"]
